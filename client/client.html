<!DOCTYPE html>
<html lang="en">

<head>
    <title>Olivieri Project 1</title>
    <link rel="stylesheet" type="text/css" href="/style.css">

    <script>

        const handleResponse = async (response, pResponse) => {

            const content = document.querySelector('#content');

            //Switch based on the response status code 
            switch (response.status) {
                case 200:
                    content.innerHTML = '<b>Success!</b>';
                    break;
                case 201:
                    content.innerHTML = `<b>Created</b>`;
                    break;
                case 400:
                    content.innerHTML = `<b>Bad Request ):</b>`;
                    break;
                case 404:
                    content.innerHTML = `<b>Resource Not Found</b>`;
                default:
                    content.innerHTML = `<b>Something went wrong ):</b>`;
                    break;
            }


            if (pResponse) {
                //parse the JSON
                let obj = await response.json();

                console.log(obj.users);

                let jsonString = JSON.stringify(obj.users);

                content.innerHTML += `<p>${jsonString}</p>`;

                //If we have a message, display it.
                //if (obj.message) {
                //content.innerHTML += `<p>${obj.message}</p>`;
                //}
            } else {
                //content.innerHTML += '<p>Meta Data Received</p>';
            }



        };

        //Uses fetch to send a post Request 

        const sendPost = async (nameForm) => {
            //Grab info from the form
            const nameAction = nameForm.getAttribute('action');
            const nameMethod = nameForm.getAttribute('method');

            //name and position of the baseball player we want to add
            const nameField = nameForm.querySelector('#nameField');
            const positionField = nameForm.querySelector('#positionField');

            //Build a data string in the FORM-URLENCODED format.
            const formData = `name=${nameField.value}&pos=${positionField.value}`;

            //Make a fetch request
            let response = await fetch(nameAction, {
                method: nameMethod,
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Accept': 'application/json',
                },
                body: formData,
            });

            handleResponse(response);
        };//end send post


        const requestUpdate = async (userForm) => {

            //Grab the url and method from the html form below
            const url = userForm.querySelector('#urlField').value;

            //Await our fetch response.
            let response = await fetch(url, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json'
                },
            });

            handleResponse(response, true);
        };


        const init = () => {
            //Grab the form
            const nameForm = document.querySelector('#nameForm');
            const userForm = document.querySelector('#userForm');

            //Create an addUser fns
            const addUser = (e) => {
                e.preventDefault();
                sendPost(nameForm);
                return false;
            }

            //Create getUser fns
            const getUsers = (e) => {
                e.preventDefault();
                requestUpdate(userForm);
                return false;
            }

            //Call addUser when the submit event fires on the name form.
            nameForm.addEventListener('submit', addUser);
            userForm.addEventListener('submit', getUsers);
        };


        window.onload = init;
    </script>

</head>

<body>
    <section id="top">
        <h3>Baseball player starter lineup Application</h3>
        <form id="nameForm" action="/addUser" method="post">
            <label for="name">Name: </label>
            <input id="nameField" type="text" name="name" />
            <label for="position">Position: </label>
            <input id="positionField" type="number" name="position" min="1" max="9" step="1" />
            <input type="submit" value="Add Player" />
        </form>
        <form id="userForm" action="/getUsers" method="get">
            <select id='urlField'>
                <option value='/getUsers'>Get Lineup</option>
            </select>
            <!--<select id="methodSelect">
                <option value="get">GET</option>
                <option value="head">HEAD</option>
            </select>-->
            <input type="submit" value="Get User" />
        </form>
    </section>
    <section id="content">
    </section>
</body>

</html>